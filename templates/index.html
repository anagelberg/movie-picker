{% extends 'bootstrap/base.html' %}
{% include "header.html" %}

{% block styles %}
  {{ super() }}
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.14.0/css/all.min.css" integrity="sha512-1PKOgIY59xJ8Co8+NE6FZ+LOAZKjy+KY8iq0G4B3CyeY6wYHN3yt9PW0XpSriVlkMXe40PTKnXrLnZ9+fkDaog==" crossorigin="anonymous" />
{% endblock %}

{% block scripts %}
<script> var coll = document.getElementsByClassName("collapsible");
var i;

for (i = 0; i < coll.length; i++) {
  coll[i].addEventListener("click", function() {
    this.classList.toggle("active");
    var content = this.nextElementSibling;
    if (content.style.maxHeight){
      content.style.maxHeight = null;
    } else {
      content.style.maxHeight = content.scrollHeight + "px";
    }
  });
}</script>

<script>
    $('#confirm-delete').on('show.bs.modal', function(e) {
    $(this).find('.btn-ok').attr('href', $(e.relatedTarget).data('href'));
});
</script>

<script>
    //triggered when modal is about to be shown (populate values for delete movie)
$('#confirm-media-delete').on('show.bs.modal', function(e) {

    //get data-id attribute of the clicked element
    var movie_name = $(e.relatedTarget).data('movie_name');
    var watchlist_name = $(e.relatedTarget).data('watchlist_name');

    //populate the textbox
    $(e.currentTarget).find('input[name="movie_name"]').val(movie_name);
    $(e.currentTarget).find('input[name="watchlist_name"]').val(watchlist_name);
});
</script>


{% endblock %}


{% block title %} My Watchlist {% endblock %}

{% block content %}
<a href="{{ url_for('test') }}" class="button">TEST</a>

<div class="container-fluid">

  <h1 class="heading">My Movie Jars</h1>


    <!-- Movie lists -->
    {% for movie_list in watchlists %}
<button type="button" class="collapsible" style="margin : 1px; fontsize: 14px;">{{movie_list.name}}</button>
<div class="content">



 <!-- display movie area -->
    <div class="container-fluid" style="margin: 2rem;">
        <div class="row justify-content-center">
    {% for movie in movie_list.movies %}
    <!-- one card -->
    <div class="card col-xl-2 col-lg-3 col-md-4 col-sm-12 border-0 m-1">
        <div class="front" style="background-image: url({{ movie.img_url }}); right:0px;">
        </div>
        <div class="back" style="right:0px; border-style:groove; border-width: 2px;">
            <div>
                <div class="title">{{ movie.title }} <br></div>
                <div class="rating_display">
                    <label>{{ movie.pop_rating }}</label>
                    <i class="fas fa-star star"></i>
                </div>
                <p class="genre">{{ movie.genre }}</p>
                <p class="genre">{{ movie.emotional_vibe }} emotionally, {{ movie.mental_vibe }} mentally </p>
                <p class="run_time">{{ movie.run_time }} minutes</p>
                <p class="overview">
                    {{ movie.description }}
                </p>

                <a href="{{ url_for('show_edit_page', movie_id=movie.id) }}" class="button">Edit</a>
                <!--<a href="{{ url_for('delete_movie', watchlist_id=movie_list.id , movie_id=movie.id) }}" class="button delete-button">Delete</a> -->
                <a data-toggle="modal" data-target="#confirm-media-delete" data-movie_name="{{ movie.title }}"
                   data-watchlist_name="{{ movie_list.name }}" class="button delete-button">Delete</a>




            </div>
        </div>
    </div>
    <!-- end card -->
    {% endfor %}

    <!-- Add movie card -->
            <div class="card col-xl-2 col-lg-3 col-md-4 col-sm-12 border-0 m-1">
                <a href="{{ url_for('show_search_screen', watchlist_id=movie_list.id) }}">
                 <div class="add_movie" style="right:0px;">
                     <h2>+ Add movie</h2>
                        </div>
                    </a>
            </div>
     <!-- -->
    </div>
        </div>
    <!--end movie display -->


<a href="#" class="button delete-button" data-href="{{ url_for('delete_movie_list', watchlist_id=movie_list.id) }}"
   data-toggle="modal" data-target="#confirm-delete"><i class="fa-solid fa-trash-can"></i> Delete Movie Jar</a>

</div>

    {%endfor %}

    <!-- Create a new jar button -->
    <form action="{{url_for('create_list')}}">
         <button class="collapsible" type="submit" style="margin : 1px; fontsize: 14px;">+ Create new movie jar</button>
      </form>

</div>


<!-- Confirm delete modal for watchlist -->
<div class="modal fade" id="confirm-delete" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                Confirm Delete
            </div>
            <div class="modal-body">
                Are you sure you want to delete this watchlist? This cannot be undone.
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-default" data-dismiss="modal">Cancel</button>
                <a class="btn btn-danger btn-ok">Delete</a>
            </div>
        </div>
    </div>
</div>


<!--Delete media modal -->
<div class="modal fade" id="confirm-media-delete" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                Confirm Delete
            </div>
            <div class="modal-body">
                <form action="{{ url_for('delete_movie')}}" method="post">
                    <div class="form-group">
                        <label for="movie_name">Delete</label>
                        <input class="readonly_input" type="text" id="movie_name" name="movie_name" readonly="readonly">

                        <label for="watchlist_name">from</label>
                        <input class=readonly_input" type="text" id="watchlist_name" name="watchlist_name" readonly="readonly">
                        <label for="watchlist_name">?</label>
                        </div>

                    <!-- Watched? -->

                     <div class="form-check form-group">
                            <input type="checkbox" name="watched_check" value="True" checked
                                   id="watched_check">
                            <label class="form-check-label" for="watched_check">I watched this.</label>
                        </div>

                    <!-- star rating -->
                    <div>
                    <label>Add a rating: </label>
                    </div>
                    <div class="rating form-group">
                        <label>
                            <input type="radio" name="stars" value="1"/>
                            <span class="icon">★</span>
                        </label>
                        <label>
                            <input type="radio" name="stars" value="2"/>
                            <span class="icon">★</span>
                            <span class="icon">★</span>
                        </label>
                        <label>
                            <input type="radio" name="stars" value="3"/>
                            <span class="icon">★</span>
                            <span class="icon">★</span>
                            <span class="icon">★</span>
                        </label>
                        <label>
                            <input type="radio" name="stars" value="4"/>
                            <span class="icon">★</span>
                            <span class="icon">★</span>
                            <span class="icon">★</span>
                            <span class="icon">★</span>
                        </label>
                        <label>
                            <input type="radio" name="stars" value="5"/>
                            <span class="icon">★</span>
                            <span class="icon">★</span>
                            <span class="icon">★</span>
                            <span class="icon">★</span>
                            <span class="icon">★</span>
                        </label>
                    </div>

                    <div>
                    <button type="submit" class="btn btn-primary">Delete</button>
                        </div>
                </form>
            </div>
        </div>
    </div>
</div>









<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha2/dist/js/bootstrap.bundle.min.js" integrity="sha384-qKXV1j0HvMUeCBQ+QVp7JcfGl760yU08IQ+GpUo5hlbpg51QRiuqHAJz8+BrxE/N" crossorigin="anonymous"></script>
<script src="{{ url_for('static', filename='js/vibe_selector.js')}}"></script>

{% endblock %}